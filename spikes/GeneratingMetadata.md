# About metadata
The ios bridge requires metadata in order to work correctly. The metadata contains information about all the interfaces, protocols, structs, unions, functions and vars that can be used in javascript. It is generated from the ios sdk and any additional frameworks or header files that the application needs. The metadata is generated by a metadata generator tool and is stored in binary format file, usually named `metadata.bin`.

# Obtaining metadata generator
## Using pre-build metadata generator
You can use the pre-build metadata generator called `MetadataGenerator`. This is an executable, self contained file.

## Building from source
The generator source code is located in `Source/Libclang/src` folder inside the repo. In order to build it first make sure that all git submodules are downloaded. This can be done using the following command:
```
git submodule update --init
```
Next, check that you have 64-bit mono installed on your system. On osx this can be obtained using the following command:
```bash
brew install mono
```
This will download and install a 64 bit mono from _homebrew_. To verify the installation type `mono --version`. Check if the architecture is _amd64_.

Finally to build the generator type:
```
cd Source/Libclang/src
xbuild Libclang.sln
```

# Generator dependencies
## Libclang
The generator needs `libclang.dylib` in order to work correctly. This library comes with Xcode and can be found in the `Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib` folder inside Xcode.

It must be specified in the userâ€™s `DYLD_LIBRARY_PATH` or `DYLD_FALLBACK_LIBRARY_PATH ` environment variable.
For bash script use this command. To do that you can use the following command:
```bash
export DYLD_LIBRARY_PATH=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib
```
**Note:** This change will be lost after a reboot. To keep the change you can add the following line in your `~/.profile` file:
```bash
DYLD_LIBRARY_PATH=/Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib
```

More information on library paths can be found [here](http://www.mono-project.com/docs/advanced/pinvoke/) and on environment variables in osx [here](http://stackoverflow.com/questions/135688/setting-environment-variables-in-os-x).

# Using the metadata generator
## Pre-build
```
MetadataGenerator --header <path>
MetadataGenerator --header <path> --output <path>
MetadataGenerator --header <path> --output --cflags <flags>
MetadataGenerator --header <path> --output <path> --iosSDKPath <path>
MetadataGenerator --header <path> --output <path> --xcodePath <path>
```

### Commands
* **header** Path to the umbrella header
* **output** Output path
* **iosSDKPath** Path to the ios sdk that will be used
* **xcodePath** Path to Xcode
* **cflags** Additional flags that will be passed directly to the clang compiler. More information [here](http://clang.llvm.org/docs/UsersManual.html).

### Examples
```
./MetadataGenerator --header tns-ios/Source/Headers/ios8.0.h
./MetadataGenerator --header tns-ios/Source/Headers/ios8.0.h --output ./metadata.bin
./MetadataGenerator --header metadata.h --output ./metadata.bin --cflags=-F./ExternalLibraries
```

## From source
```
mono Libclang.exe --header <path>
mono Libclang.exe --header <path> --output <path>
mono Libclang.exe --header <path> --output --cflags <flags>
mono Libclang.exe --header <path> --output <path> --iosSDKPath <path>
mono Libclang.exe --header <path> --output <path> --xcodePath <path>
```

## Using grunt
```
grunt dist-metadata
grunt metadata -header <path> -output <path> -cflags <flags>
grunt test-metadata
```
